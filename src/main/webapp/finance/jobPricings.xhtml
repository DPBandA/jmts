<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html
    xmlns="http://www.w3.org/1999/xhtml"
    xmlns:h="http://java.sun.com/jsf/html"
    xmlns:f="http://java.sun.com/jsf/core"
    xmlns:p="http://primefaces.org/ui"
    xmlns:ui="http://java.sun.com/jsf/facelets"> 
    <h:head>
        <meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
        <meta http-equiv="cache-control" content="max-age=0" />
        <meta http-equiv="cache-control" content="no-cache" />
        <meta http-equiv="expires" content="0" />
        <meta http-equiv="expires" content="Tue, 01 Jan 1980 1:00:00 GMT" />
        <meta http-equiv="pragma" content="no-cache" />
        <title>Price List</title>
        <style type="text/css">
            .ui-widget {
                font-size: 80%;
            }          
            .ui-layout-north {
                z-index:20 !important;
                overflow:visible !important;;
            }

            .ui-layout-north .ui-layout-unit-content {
                overflow:visible !important;
            }
        </style>        
    </h:head>
    <h:body >       
        <ui:include src="common/commonDialogs.xhtml" />
        <ui:include src="common/longProcessDialog.xhtml"/> 
        <h:form id="unitCostForm">
            <p:dialog width="500"
                      height="400"
                      draggable="true"
                      modal="true"      
                      closable="false" 
                      widgetVar="unitCostDialog"
                      header="Price Detail" >
                <p:commandButton actionListener="#{jobManager.saveUnitCost}"                            
                                 onstart="longProcessDialogVar.show();"
                                 oncomplete="longProcessDialogVar.hide();"
                                 value="Save"                                     
                                 title="Save unit cost"
                                 icon="ui-icon-disk"
                                 process="@this"/>
                <p:spacer height="0" width="10"/>
                <p:commandButton value="Close"
                                 actionListener="#{jobManager.closeUnitCostDialog}"
                                 onstart="longProcessDialogVar.show();"
                                 oncomplete="longProcessDialogVar.hide();"
                                 async="true"                                                                
                                 process="@this"
                                 icon="ui-icon ui-icon-close" />                   
                <hr/>
                <h:panelGrid columns="2" cellspacing="3">  
                    <h:outputText value="Department *:" />
                    <h:panelGroup>
                        <p:autoComplete 
                            id="currentUnitCostDepartment"
                            var="department"
                            forceSelection="true" 
                            size="40"
                            maxlength="250"
                            value="#{jobManager.currentUnitCost.department}"
                            title="#{jobManager.currentUnitCost.department}"
                            itemValue="#{department}"
                            itemLabel="#{department.name}"
                            converter="departmentConverter"
                            completeMethod="#{jobManager.completeDepartment}" >
                            <p:ajax event="itemSelect"
                                    listener="#{jobManager.updateCurrentUnitCostDepartment}"
                                    global="false"                                    
                                    process="@this"/>
                            <p:ajax event="keyup"
                                    listener="#{jobManager.updateCurrentUnitCostDepartment}"
                                    global="false"                                    
                                    process="@this" />
                        </p:autoComplete>     
                        <p:watermark for="currentUnitCostDepartment" value="-- select department --"/>   
                    </h:panelGroup>   

                    <h:outputText value="Department unit:" />
                    <h:panelGroup>
                        <p:autoComplete 
                            id="currentUnitCostDepartmentUnit"
                            var="departmentUnit"
                            forceSelection="true" 
                            size="40"
                            maxlength="250"
                            value="#{jobManager.currentUnitCost.departmentUnit}"
                            title="#{jobManager.currentUnitCost.departmentUnit}"
                            itemValue="#{departmentUnit}"
                            itemLabel="#{departmentUnit.name}"
                            converter="departmentUnitConverter"
                            completeMethod="#{jobManager.completeDepartmentUnit}" >
                            <p:ajax event="itemSelect"
                                    listener="#{jobManager.updateCurrentUnitCostDepartmentUnit}"
                                    global="false"                                    
                                    process="@this" />
                            <p:ajax event="keyup"
                                    listener="#{jobManager.updateCurrentUnitCostDepartmentUnit}"
                                    global="false"                                    
                                    process="@this" />
                        </p:autoComplete>     
                        <p:watermark for="currentUnitCostDepartmentUnit" value="-- select department unit--"/>   
                    </h:panelGroup>   

                    <h:outputText value="Laboratory:" />
                    <h:panelGroup>
                        <p:autoComplete 
                            id="unitCostDepartmentLaboratory"
                            var="laboratory"
                            forceSelection="true" 
                            size="40"
                            maxlength="250"
                            value="#{jobManager.currentUnitCost.laboratory}"
                            title="#{jobManager.currentUnitCost.laboratory}"
                            itemValue="#{laboratory}"
                            itemLabel="#{laboratory.name}"
                            converter="laboratoryConverter"
                            completeMethod="#{jobManager.completeLaboratory}" >
                            <p:ajax event="itemSelect"
                                    listener="#{jobManager.updateCurrentUnitCostDepartmentLab}"
                                    global="false"                                    
                                    process="@this" />
                            <p:ajax event="keyup"
                                    listener="#{jobManager.updateCurrentUnitCostDepartmentLab}"
                                    global="false"                                    
                                    process="@this" />
                        </p:autoComplete>     
                        <p:watermark for="unitCostDepartmentLaboratory" value="-- select laboratory --"/>   
                    </h:panelGroup>   

                    <h:outputText value="Service *:" />
                    <h:panelGroup >
                        <p:inputText style="width: 300px"
                                     value="#{jobManager.currentUnitCost.service}" >
                            <p:ajax
                                global="true"
                                listener="#{jobManager.update}"                               
                                process="@this" />
                        </p:inputText>                       
                    </h:panelGroup>  

                    <h:outputText value="Cost *:" />                    
                    <p:inputText style="width: 100px"
                                 value="#{jobManager.currentUnitCost.cost}" >
                        <f:convertNumber minFractionDigits="2" maxFractionDigits="2"/>
                        <p:ajax
                            global="true"
                            listener="#{jobManager.update}"                               
                            process="@this" />
                    </p:inputText>

                    <h:outputText value="Unit:" />
                    <h:panelGroup >
                        <p:inputText style="width: 300px"
                                     value="#{jobManager.currentUnitCost.unit}" >
                            <p:ajax
                                global="true"
                                listener="#{jobManager.update}"                               
                                process="@this" />
                        </p:inputText>                       
                    </h:panelGroup>  

                    <h:outputText value="Effective date *:" />
                    <p:calendar id="effectiveDate"
                                value="#{jobManager.currentUnitCost.effectiveDate}"
                                navigator="true"
                                pattern="MMM dd, yyyy" >
                        <p:ajax event="dateSelect"                                
                                listener="#{jobManager.update}" />
                        <p:ajax event="keyup"                                
                                listener="#{jobManager.update}" />
                    </p:calendar>

                    <h:outputText value="Description: " style="vertical-align: top" />
                    <p:inputTextarea value="#{jobManager.currentUnitCost.description}"
                                     style="width: 300px"
                                     rows="1"
                                     maxlength="1000"
                                     autoResize="false">
                        <p:ajax event="keyup"
                                listener="#{jobManager.update}"
                                process="@this"/>
                    </p:inputTextarea>     
                </h:panelGrid>
                <hr/>
                <p:commandButton actionListener="#{jobManager.saveUnitCost}"                            
                                 onstart="longProcessDialogVar.show();"
                                 oncomplete="longProcessDialogVar.hide();"
                                 value="Save"                                     
                                 title="Save unit cost"
                                 icon="ui-icon-disk"
                                 process="@this"/>
                <p:spacer height="0" width="10"/>
                <p:commandButton value="Close"
                                 actionListener="#{jobManager.closeUnitCostDialog}"
                                 onstart="longProcessDialogVar.show();"
                                 oncomplete="longProcessDialogVar.hide();"
                                 async="true"                                                                
                                 process="@this"
                                 icon="ui-icon ui-icon-close" />                  

            </p:dialog>
        </h:form>
        <p:layout fullPage="true" >
            <p:layoutUnit position="center" >
                <h:form>
                    <p:toolbar>
                        <p:toolbarGroup align="left" >
                            <h:panelGroup >     
                                <p:autoComplete id="unitCostDepartment"                                                
                                                var="department"
                                                forceSelection="true" 
                                                dropdown="false"
                                                size="30"
                                                maxlength="250"
                                                value="#{jobManager.unitCostDepartment}"
                                                title="#{jobManager.unitCostDepartment}"
                                                itemValue="#{department}"
                                                itemLabel="#{department.name}" 
                                                converter="departmentConverter"
                                                completeMethod="#{jobManager.completeDepartment}" >
                                    <p:ajax event="itemSelect"
                                            listener="#{jobManager.updateUnitCostDepartment}"   
                                            update=":unitCostsTableForm"
                                            global="false"                                            
                                            process="@this" />
                                    <p:ajax event="keyup"                                            
                                            listener="#{jobManager.updateUnitCostDepartment}"
                                            update=":unitCostsTableForm"
                                            global="false"                                           
                                            process="@this" />
                                </p:autoComplete>                                
                                <p:watermark for="unitCostDepartment" value="-- selec a department --"/>   
                            </h:panelGroup>
                            <p:spacer height="0" width="25"/>
                            <h:panelGroup>
                                <p:inputText id="unitCostSearchText" 
                                             value="#{jobManager.searchText}" />
                                <p:watermark value="-- enter search text --" for="unitCostSearchText" />
                                <p:spacer height="0" width="5"/>
                                <p:commandButton value="Search"                                                 
                                                 onstart="longProcessDialogVar.show();"
                                                 oncomplete="longProcessDialogVar.hide();"
                                                 onerror="connectionErrorDialog.show();" 
                                                 actionListener="#{jobManager.doUnitCostSearch}"
                                                 icon="ui-icon-search"
                                                 process="@this,unitCostDepartment,unitCostSearchText"/>
                            </h:panelGroup>
                            <p:spacer height="0" width="25"/>
                            <p:commandButton value="New"                                                 
                                             onstart="longProcessDialogVar.show();"
                                             oncomplete="longProcessDialogVar.hide();"
                                             onerror="connectionErrorDialog.show();" 
                                             actionListener="#{jobManager.createNewUnitCost}"
                                             icon="ui-icon-plus"
                                             process="@this"/>

                        </p:toolbarGroup>

                    </p:toolbar>

                </h:form>
                <hr/>

                <h:form id="unitCostsTableForm">
                    <p:dataTable id="unitCostsTable"
                                 var="unitCost"
                                 paginator="true"
                                 rendered="true"
                                 rows="15"
                                 paginatorTemplate="{FirstPageLink} {PreviousPageLink} {CurrentPageReport} {NextPageLink} {LastPageLink}"
                                 value="#{jobManager.unitCosts}">
                        <ui:remove>
                            <f:facet name="header">
                                <h:outputText value="Price List" />
                            </f:facet>
                        </ui:remove>

                        <p:column>
                            <f:facet name="header">
                                <h:outputText value="Department"/>
                            </f:facet>
                            <h:outputText value="#{unitCost.department.name}" />
                        </p:column>

                        <p:column>
                            <f:facet name="header">
                                <h:outputText value="Lab/Unit"/>
                            </f:facet>
                            <h:outputText value="#{unitCost.laboratoryAndDepartmentUnitName}" />
                        </p:column>

                        <p:column>
                            <f:facet name="header">
                                <h:outputText value="Service"/>
                            </f:facet>
                            <h:outputText value="#{unitCost.service}" />
                        </p:column>

                        <p:column>
                            <f:facet name="header">
                                <h:outputText value="Unit Cost"/>
                            </f:facet>
                            <h:outputText value="#{unitCost.cost}" />
                        </p:column>

                        <p:column style="width:32px">
                            <p:commandButton title="View/Edit"
                                             onstart="longProcessDialogVar.show();"
                                             onerror="connectionErrorDialog.show();"
                                             actionListener="#{jobManager.editUnitCost}"
                                             update=":unitCostForm"
                                             oncomplete="unitCostDialog.show();"
                                             global="true"
                                             icon="ui-icon-pencil">
                                <f:setPropertyActionListener value="#{unitCost}" 
                                                             target="#{jobManager.currentUnitCost}" />
                            </p:commandButton>
                        </p:column>
                    </p:dataTable>
                </h:form>
            </p:layoutUnit>
        </p:layout>

    </h:body>
</html>

