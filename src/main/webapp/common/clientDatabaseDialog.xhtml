<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html
    xmlns="http://www.w3.org/1999/xhtml"
    xmlns:h="http://java.sun.com/jsf/html"
    xmlns:f="http://java.sun.com/jsf/core"
    xmlns:p="http://primefaces.org/ui"
    xmlns:ui="http://java.sun.com/jsf/facelets">
    <h:head>
        <meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
        <meta http-equiv="cache-control" content="max-age=0" />
        <meta http-equiv="cache-control" content="no-cache" />
        <meta http-equiv="expires" content="0" />
        <meta http-equiv="expires" content="Tue, 01 Jan 1980 1:00:00 GMT" />
        <meta http-equiv="pragma" content="no-cache" />
        <title>Client Database</title>
        <style type="text/css">
            .ui-widget {
                font-size: 80%;
            }          
            .ui-layout-north {
                z-index:20 !important;
                overflow:visible !important;;
            }

            .ui-layout-north .ui-layout-unit-content {
                overflow:visible !important;
            }
        </style>        
    </h:head>
    <h:body >       
        <ui:insert>                     
            <ui:include src="../common/clientForm.xhtml" />
            <ui:include src="../common/commonDialogs.xhtml" />
            <ui:include src="../common/longProcessDialog.xhtml"/>             
        </ui:insert>        
        <p:layout fullPage="true" >            
            <p:layoutUnit position="center" >                    
                <h:form>
                    <p:toolbar>
                        <p:toolbarGroup align="left">                            
                            <p:commandButton value="New"
                                             icon="ui-icon-plus"
                                             onstart="longProcessDialogVar.show();"
                                             rendered="#{jobManager.user.privilege.canAddClient}"
                                             actionListener="#{clientManager.createNewClient}"
                                             update=":clientForm"
                                             oncomplete="clientFormDialog.show();longProcessDialogVar.hide();"
                                             process="@this"
                                             title="Add a new client"/>
                        </p:toolbarGroup>
                        <p:toolbarGroup align="right" >                            
                            <h:panelGroup>
                                <p:inputText id="clientSearchText" 
                                             value="#{clientManager.clientSearchText}" />
                                <p:watermark value="-- enter search text --" for="clientSearchText" />
                                <p:spacer height="0" width="5"/>
                                <p:commandButton value="Search"                                                 
                                                 onstart="longProcessDialogVar.show();"
                                                 oncomplete="longProcessDialogVar.hide();"
                                                 onerror="connectionErrorDialog.show();" 
                                                 actionListener="#{clientManager.doClientSearch}"
                                                 update=":clientsTableForm:clientsTable"
                                                 icon="ui-icon-search"
                                                 process="@this,clientSearchText"/>
                            </h:panelGroup>                    

                        </p:toolbarGroup>

                    </p:toolbar>

                </h:form>
                <hr/>

                <h:form id="clientsTableForm">

                    <p:dataTable id="clientsTable"
                                 var="client"
                                 paginator="true"                                 
                                 rows="10"
                                 paginatorTemplate="{FirstPageLink} {PreviousPageLink} {CurrentPageReport} {NextPageLink} {LastPageLink}"
                                 value="#{clientManager.foundClients}">                        

                        <p:column sortBy="#{client.name}">
                            <f:facet name="header">
                                <h:outputText value="Name"/>
                            </f:facet>
                            <h:outputText value="#{client.name}" />
                        </p:column>

                        <p:column sortBy="#{client.enteredBy}">
                            <f:facet name="header">
                                <h:outputText value="Entered by"/>
                            </f:facet>
                            <h:outputText value="#{client.enteredBy}" />
                        </p:column>

                        <p:column sortBy="#{client.dateEntered}">
                            <f:facet name="header">
                                <h:outputText value="Date entered"/>
                            </f:facet>
                            <h:outputText value="#{client.dateEntered}">
                                <f:convertDateTime pattern="MMM dd, yyyy"/>
                            </h:outputText>
                        </p:column>

                        <ui:remove>
                            <p:column>                            
                                <f:facet name="header">
                                    <h:outputText value="In Master Database?"/>
                                </f:facet>
                                <p:selectBooleanCheckbox disabled="true" value="#{client.active}" />
                            </p:column>
                        </ui:remove>

                        <p:column style="width:32px">
                            <p:commandButton icon="ui-icon-pencil"
                                             onstart="longProcessDialogVar.show();"
                                             actionListener="#{clientManager.editClient}"
                                             update=":clientForm"
                                             oncomplete="clientFormDialog.show();longProcessDialogVar.hide();"
                                             process="@this"
                                             title="View or edit this client's detail">
                                <f:setPropertyActionListener value="#{client}" 
                                                             target="#{clientManager.client}" />
                            </p:commandButton>
                        </p:column>
                    </p:dataTable>
                </h:form>                   
            </p:layoutUnit>            
        </p:layout>
    </h:body>
</html>

