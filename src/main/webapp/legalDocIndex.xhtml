<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml"
      xmlns:p="http://primefaces.org/ui"
      xmlns:h="http://java.sun.com/jsf/html"
      xmlns:f="http://java.sun.com/jsf/core"
      xmlns:ui="http://java.sun.com/jsf/facelets"> 
    <h:head>
        <title>Legal Documents</title>
        <meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
        <meta http-equiv="cache-control" content="max-age=0" />
        <meta http-equiv="cache-control" content="no-cache" />
        <meta http-equiv="expires" content="0" />
        <meta http-equiv="expires" content="Tue, 01 Jan 1980 1:00:00 GMT" />
        <meta http-equiv="pragma" content="no-cache" />

        <style type="text/css" >
            .ui-widget {
                font-size: 80%;
            }
            .due {
                background-color: yellow;
                background-image: none;
                color: #000000;
            }
            .notdue {
                background-color: white;
                background-image: none;
                color: #000000;
            }
        </style>
        <script src="js/legalDocJavascript.js" type="text/javascript" />

    </h:head>
    <h:body>
        <ui:insert>
            <ui:include src="legaldoc/legalDocDialogs.xhtml"/>
            <ui:include src="legaldoc/legalDocClientDialog.xhtml"/>
        </ui:insert>

        <p:layout fullPage="true">
            <p:layoutUnit position="north"  header="Legal Documents" >
                <h:form id="headerForm">
                    <table border="0" width="100%">
                        <tr>
                            <td>
                                <img src="images/BSJ-Logo.jpg" width="272" height="41" alt="BSJ Logo"/>
                            </td>                           

                            <td align="left">
                                <h:outputText value="Legal Documents"
                                              style="color: gray; font-size: 14pt; font-weight: bold" />
                            </td>                       

                            <td>
                                <h:outputText id="systemInfo" value="#{legalDocumentManager.systemInfo}" />
                            </td>

                            <td align="right">
                                <p:commandButton value="Add document"
                                                 update=":documentDialogForm"
                                                 actionListener="#{legalDocumentManager.createNewLegalDocument}"
                                                 title="Add a new document"
                                                 oncomplete="documentDialog.show();"
                                                 icon="ui-icon ui-icon-plus"
                                                 process="@this" />
                                <p:spacer width="25px" height="0px"/>
                                <p:commandButton id="loginButton"
                                                 style="font-weight: bold"
                                                 rendered="#{!legalDocumentManager.showLogin}"
                                                 action="#{legalDocumentManager.logout}"
                                                 oncomplete="reloadCurrentPage();"
                                                 icon="ui-icon-person"
                                                 value="Logout: #{legalDocumentManager.user.employee.firstName} #{legalDocumentManager.user.employee.lastName}"
                                                 process="@this" />
                            </td>
                        </tr>
                    </table>  
                </h:form>
            </p:layoutUnit>

            <p:layoutUnit position="west" size="325" minSize="325"
                          header="Document Search" resizable="true" collapsible="true">
                <h:form id="searchForm">
                    <p:remoteCommand name="keepAliveRequest"
                                     actionListener="#{legalDocumentManager.handleKeepAlive}"
                                     update="@this"
                                     process="@this"/>

                    <p:accordionPanel activeIndex="#{legalDocumentManager.activeNavigationTabIndex}">
                        <p:ajax event="tabChange" listener="#{legalDocumentManager.onNavigationTabChange}" update=":LegalDocumentDatabaseForm"/>

                        <p:tab title="Document search criteria">
                            <h:panelGrid columns="2">

                                <h:outputText value="Search type: " />
                                <p:selectOneMenu value="#{legalDocumentManager.searchType}" style="width: 100%;" >
                                    <p:ajax update="searchText,:LegalDocumentDatabaseForm"
                                            global="false"
                                            listener="#{legalDocumentManager.updateSearchText}"
                                            process="@this" />
                                    <f:selectItems value="#{JMTSApp.searchTypes}" />
                                </p:selectOneMenu>

                                <h:outputText value="Date field: " />
                                <p:selectOneMenu value="#{legalDocumentManager.dateSearchField}" style="width: 100%;" >
                                    <p:ajax update="searchText,:LegalDocumentDatabaseForm"
                                            global="false"
                                            listener="#{legalDocumentManager.updateSearchText}"
                                            process="@this" />
                                    <f:selectItems value="#{JMTSApp.dateFields}" />
                                </p:selectOneMenu>
                                <h:outputText value="Date period: " />
                                <p:selectOneMenu value="#{legalDocumentManager.dateSearchPeriod}" style="width: 100%;" >
                                    <p:ajax update="startSearchDate,endSearchDate,:LegalDocumentDatabaseForm"
                                            global="false"
                                            listener="#{legalDocumentManager.changeSearchDatePeriod}"
                                            process="@this" />
                                    <f:selectItems value="#{JMTSApp.datePeriods}" />
                                </p:selectOneMenu >

                                <h:outputText value="Start date:"/>
                                <p:calendar id="startSearchDate"
                                            value="#{legalDocumentManager.startDate}"
                                            navigator="true"
                                            disabled="#{legalDocumentManager.startSearchDateDisabled}"
                                            pattern="MMM dd, yyyy" >
                                    <p:ajax event="dateSelect"
                                            update=":LegalDocumentDatabaseForm"
                                            listener="#{legalDocumentManager.handleStartSearchDateSelect}" />
                                    <p:ajax event="keyup"
                                            update=":LegalDocumentDatabaseForm"
                                            listener="#{legalDocumentManager.handleStartSearchDateSelect}" />
                                </p:calendar>

                                <h:outputText value="End date:"/>
                                <p:calendar id="endSearchDate"
                                            value="#{legalDocumentManager.endDate}"
                                            navigator="true"
                                            disabled="#{legalDocumentManager.endSearchDateDisabled}"
                                            pattern="MMM dd, yyyy" >
                                    <p:ajax event="dateSelect"
                                            update=":LegalDocumentDatabaseForm"
                                            listener="#{legalDocumentManager.handleEndSearchDateSelect}" />
                                    <p:ajax event="keyup"
                                            update=":LegalDocumentDatabaseForm"
                                            listener="#{legalDocumentManager.handleEndSearchDateSelect}" />
                                </p:calendar>
                            </h:panelGrid>
                            <h:panelGrid columns="4" rendered="#{legalDocumentManager.searchTextVisible}">
                                <p:autoComplete value="#{legalDocumentManager.searchText}"
                                                id="searchText"
                                                completeMethod="#{legalDocumentManager.completeSearchText}"/>
                                <p:watermark for="searchText" value="-- all documents --" />
                                <p:commandButton title="Search for documents"
                                                 actionListener="#{legalDocumentManager.doLegalDocumentSearch}"
                                                 async="true"
                                                 icon="ui-icon-search"
                                                 update=":LegalDocumentDatabaseForm"
                                                 process="@form"/>
                                <p:ajaxStatus >
                                    <f:facet name="start">
                                        <h:graphicImage value="images/ajaxloading.gif" width="14" height="14"/>
                                    </f:facet>
                                    <f:facet name="success">
                                        <h:outputText value=" " />
                                    </f:facet>
                                </p:ajaxStatus>
                            </h:panelGrid> <p/>
                        </p:tab>                       
                    </p:accordionPanel>
                </h:form>
            </p:layoutUnit>

            <p:layoutUnit id="centerLayoutUnit" position="center">
                <h:form id="LegalDocumentDatabaseForm">
                    <p:tabView id="mainTabView"
                               widgetVar="mainTabViewVar"
                               activeIndex="#{legalDocumentManager.activeTabIndex}"
                               dynamic="true">
                        <p:ajax event="tabChange" listener="#{legalDocumentManager.onMainTabChange}" 
                                update=":searchForm"/>


                        <p:tab id="LegalDocumentDatabaseTab" title="Documents database">

                            <ui:insert>
                                <ui:include src="legaldoc/legalDocDatabaseTab.xhtml"/>
                            </ui:insert>

                        </p:tab>
                        <p:tab id="LegalDocumentReportTab" title="Reporting">

                            <ui:insert>
                                <ui:include src="legaldoc/legalDocReportingTab.xhtml"/>
                            </ui:insert>

                        </p:tab>
                    </p:tabView>

                    <p:remoteCommand actionListener="#{legalDocumentManager.postProcessXLS}"
                                     name="updateSelectedDocument"
                                     process="@this" />
                </h:form>
            </p:layoutUnit>


        </p:layout>


    </h:body>
</html>

