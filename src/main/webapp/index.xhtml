<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html
    xmlns="http://www.w3.org/1999/xhtml"
    xmlns:h="http://java.sun.com/jsf/html"
    xmlns:f="http://java.sun.com/jsf/core"
    xmlns:p="http://primefaces.org/ui"
    xmlns:ui="http://java.sun.com/jsf/facelets"> 
    <h:head>
        <meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />    
        <meta http-equiv="cache-control" content="max-age=0" />
        <meta http-equiv="cache-control" content="no-cache" />
        <meta http-equiv="expires" content="0" />
        <meta http-equiv="expires" content="Tue, 01 Jan 1980 1:00:00 GMT" />
        <meta http-equiv="pragma" content="no-cache" />

        <title>Job Management &amp; Tracking System</title>
        <style type="text/css">
            .ui-widget {
                font-size: 80%;
            }
            .jobNumberClass {
                width: 100%;
                color: orange;
            }  
            .editableclass {
                background-color: lightgoldenrodyellow !important;
            }
            .hold {
                color: red;
                font-size: 1.2em;
                background-image: none;
                font-weight: bolder;
            }
            .active {
                color: green;
                font-size: 1.2em;
                background-image: none;
                font-weight: bolder;
            }   
            .due {
                background-color: yellow;
                background-image: none;
                color: #000000;
            }
            .overdue {
                background-color: yellow;
                background-image: none;
                color: #000000;
            }
            .lightgreybg {
                background-color:lightgrey;
                background-image: none;
                color: #000000;
            }
            .lightsteelbg {
                background-color:lightsteelblue;
                background-image: none;
                color: #000000;
            }
            .header {
                background-color: gray;
                background-image: none;
                color: white;
            }
            .rdonly {
                background-color: lightgrey;
                background-image: none;
                color: blue;
            }
            .default {
                background-color: white;
                background-image: none;
                color: black;
            }
        </style>
        <script type="text/javascript" src="js/jmtsJavascript.js" />      
        <script type="text/javascript" src="js/commonJavascript.js" />     
        <link rel="shortcut icon" type="image/x-png" href="images/favicon.png" />

    </h:head>
    <h:body onload="checkWhichBrowser();
            longProcessDialogVar.hide();
            mainTabViewVar.select(0);"            
            onmouseover="longProcessDialogVar.hide();">

        <ui:insert>                 
            <ui:include src="common/commonDialogs.xhtml" />                       
            <ui:include src="common/loginDialog.xhtml"/>
            <ui:include src="accpac/accPacClientInformationDialog.xhtml"/>
            <ui:include src="jmts/reportingDialog.xhtml"/>   
            <ui:include src="jmts/jobSampleDialogs.xhtml"/>
            <ui:include src="jmts/jmtsAlertDialogs.xhtml"/>
            <ui:include src="common/generalAlertDialogs.xhtml"/>
            <ui:include src="common/connectionErrorAlertDialog.xhtml"/>
            <ui:include src="common/longProcessDialog.xhtml"/>   
            <ui:include src="jmts/saveConfirmationDialogs.xhtml"/>    

            <ui:include src="common/preferencesDialog.xhtml"/>   
            <ui:include src="finance/cashPaymentDialog.xhtml"/>
        </ui:insert>      

        <p:layout id="JMTSWeb" fullPage="true" widgetVar="layoutVar" >
            <p:ajax event="toggle" listener="#{main.handleLayoutUnitToggle}" />

            <p:layoutUnit position="north" 
                          rendered="true" 
                          size="75"                          
                          header="" >
                <h:form id="headerForm">    
                    <h:panelGrid width="100%" border="0" columns="3">
                        <p:graphicImage rendered="#{main.renderUserMenu()}" 
                                        value="images/Logo.jpg"/>
                        <h:outputText value="Job Management &amp; Tracking System"
                                      rendered="#{main.renderUserMenu()}" 
                                      style="color: gray; font-size: 14pt; font-weight: bold" />                       
                        <p:menuButton value="#{main.user.employee.firstName} #{main.user.employee.lastName}"     
                                      style="float: right;"
                                      rendered="#{main.renderUserMenu()}">
                            <p:menuitem actionListener="#{jobManager.editPreferences}"
                                        onstart="longProcessDialogVar.show();"
                                        update=":preferencesDialogForm"
                                        oncomplete="longProcessDialogVar.hide();preferencesDialog.show();"
                                        onerror="connectionErrorDialog.show();"    
                                        value="Preferences"
                                        process="@this"/>
                            <p:separator />  
                            <p:menuitem actionListener="#{main.logout}"
                                        onstart="longProcessDialogVar.show();"                                               
                                        onerror="connectionErrorDialog.show();"                                              
                                        icon="ui-icon-circle-arrow-w"
                                        value="Logout"
                                        process="@this"/>
                        </p:menuButton>   

                    </h:panelGrid>

                    <p:remoteCommand name="updateHeaderForm"
                                     update="headerForm"
                                     process="@this"/>

                </h:form>
            </p:layoutUnit>

            <p:layoutUnit id="centreLayoutUnit"                           
                          position="center">

                <h:form id="mainTabViewForm">

                    <p:defaultCommand target=":mainTabViewForm:mainTabView:doNothingButton" />

                    <p:tabView id="mainTabView"
                               dynamic="false"                              
                               widgetVar="mainTabViewVar">

                        <p:ajax event="tabChange" 
                                onstart="longProcessDialogVar.show();"
                                oncomplete="longProcessDialogVar.hide();"
                                listener="#{jobManager.onMainViewTabChange}" />

                        <p:ajax event="tabClose" 
                                onstart="longProcessDialogVar.show();"
                                oncomplete="longProcessDialogVar.hide();"
                                listener="#{jobManager.onMainViewTabClose}" />                       

                        <p:tab id="jobsTab"
                               closable="false"
                               title="#{jobManager.user.jobTableViewPreference}"
                               rendered="#{main.user.jobManagementAndTrackingUnit}" >
                            <ui:insert >       
                                <ui:include src="jmts/jobsTab.xhtml"/>                                     
                            </ui:insert>       
                        </p:tab>         

                        <p:tab id="jobDetailTab" 
                               title="Job Detail - #{jobManager.currentJob.jobNumber}"
                               rendered="#{jobManager.renderJobDetailTab}"
                               closable="true">
                            <ui:insert >       
                                <ui:include src="jmts/jobDetail.xhtml"/>                                     
                            </ui:insert>
                        </p:tab>

                        <p:tab id="FinancialAdminTab" title="Financial Administration"
                               closable="false" 
                               rendered="#{main.user.financialAdminUnit}">  
                            <ui:insert >       
                                <ui:include src="admin/financialAdminTab.xhtml"/>                                     
                            </ui:insert>
                        </p:tab>


                        <p:tab id="AdminTab" title="System Administration"
                               closable="false" 
                               rendered="#{main.user.renderAdminUnit}">  
                            <ui:insert >       
                                <ui:include src="admin/generalAdminTab.xhtml"/>                                     
                            </ui:insert>
                        </p:tab>

                    </p:tabView>
                </h:form>
            </p:layoutUnit>

            <p:layoutUnit
                id="searchLayoutUnit"    
                position="west" 
                size="350"                
                header="Advanced Search"
                resizable="true"                  
                collapsed="#{main.searchLayoutUnitCollapsed}"
                collapsible="true">              

                <h:panelGrid columns="1">
                    <ui:insert>
                        <ui:include src="jmts/jobSearchForm.xhtml"/>
                    </ui:insert>
                </h:panelGrid>


            </p:layoutUnit>

        </p:layout>

    </h:body>
</html>

