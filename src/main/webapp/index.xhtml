<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html
    xmlns="http://www.w3.org/1999/xhtml"
    xmlns:h="http://java.sun.com/jsf/html"
    xmlns:f="http://java.sun.com/jsf/core"
    xmlns:p="http://primefaces.org/ui"
    xmlns:ui="http://java.sun.com/jsf/facelets"> 
    <h:head>
        <meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />    
        <meta http-equiv="cache-control" content="max-age=0" />
        <meta http-equiv="cache-control" content="no-cache" />
        <meta http-equiv="expires" content="0" />
        <meta http-equiv="expires" content="Tue, 01 Jan 1980 1:00:00 GMT" />
        <meta http-equiv="pragma" content="no-cache" />
        <title>#{jobManager.applicationHeader}</title>        
        <script type="text/javascript" src="js/jmtsJavascript.js" />      
        <script type="text/javascript" src="js/commonJavascript.js" />   
        <link rel="stylesheet" href="css/index.css" />
    </h:head>
    <h:body onload="checkWhichBrowser();
            longProcessDialogVar.hide();
            mainTabViewVar.select(0);"            
            onmouseover="longProcessDialogVar.hide();">
        <ui:include src="common/commonDialogs.xhtml" />                       
        <ui:include src="common/loginDialog.xhtml"/>
        <ui:include src="accpac/accPacClientInformationDialog.xhtml"/>
        <ui:include src="jmts/reportingDialog.xhtml"/>   
        <ui:include src="jmts/jobSampleDialogs.xhtml"/>
        <ui:include src="jmts/jmtsAlertDialogs.xhtml"/>
        <ui:include src="common/generalAlertDialogs.xhtml"/>
        <ui:include src="common/connectionErrorAlertDialog.xhtml"/>
        <ui:include src="common/longProcessDialog.xhtml"/>   
        <ui:include src="jmts/jobMessageDialogs.xhtml"/>    

        <ui:include src="common/preferencesDialog.xhtml"/>   
        <ui:include src="finance/cashPaymentDialog.xhtml"/>

        <p:layout id="JMTSWeb" fullPage="true" widgetVar="layoutVar" >
            <p:ajax event="toggle" listener="#{jobManager.handleLayoutUnitToggle}" />

            <p:layoutUnit position="north" 
                          rendered="true" 
                          header=""
                          style="border: 0;" 
                          size="75" >
                <h:form id="headerForm">   
                    <p:growl id="growl3" life="5000" showDetail="true" />
                    <h:panelGrid rendered="#{jobManager.renderUserMenu()}" width="100%" 
                                 border="0" columns="3" >
                        <p:graphicImage value="images/Logo.jpg"/>
                        <h:panelGrid>   

                            <div align="center">
                                <span style="color: darkgrey; font-size: 14pt; font-weight: bold;">
                                    #{jobManager.applicationHeader}
                                </span>  
                                <br />
                                <div style=" padding-top: 5px;">
                                    <span style="color: darkgrey; font-size: 10pt; font-weight: bold;">
                                        #{jobManager.applicationSubheader}
                                    </span>   
                                </div>
                            </div>

                        </h:panelGrid>
                        <p:menuButton value="#{jobManager.user.employee.firstName} #{jobManager.user.employee.lastName}"     
                                      iconPos="left"
                                      style="float: right;" >

                            <p:menuitem actionListener="#{jobManager.openJobsTab}"
                                        onstart="longProcessDialogVar.show();"                                        
                                        oncomplete="longProcessDialogVar.hide();"                                            
                                        value="Jobs"
                                        process="@this"/>
                            <p:menuitem value="Clients"
                                        onstart="longProcessDialogVar.show();"                                                    
                                        actionListener="#{jobManager.openClientsTab}"
                                        oncomplete="longProcessDialogVar.hide();"
                                        process="@this"/>
                            <p:separator /> 
                            <p:menuitem actionListener="#{jobManager.openSystemAdministrationTab}"
                                        rendered="#{jobManager.user.privilege.canBeJMTSAdministrator}"
                                        onstart="longProcessDialogVar.show();"                                        
                                        oncomplete="longProcessDialogVar.hide();"                                            
                                        value="System Administration"
                                        process="@this"/>
                            <p:menuitem actionListener="#{jobManager.openFinancialAdministrationTab}"
                                        rendered="#{jobManager.user.privilege.canBeFinancialAdministrator}"
                                        onstart="longProcessDialogVar.show();"                                        
                                        oncomplete="longProcessDialogVar.hide();"                                            
                                        value="Financial Administration"
                                        process="@this"/>
                            <p:separator />                              
                            <p:menuitem actionListener="#{jobManager.editPreferences}"
                                        onstart="longProcessDialogVar.show();"
                                        update=":preferencesDialogForm"
                                        oncomplete="longProcessDialogVar.hide();preferencesDialog.show();"
                                        onerror="connectionErrorDialog.show();"    
                                        value="Preferences"
                                        process="@this"/>
                            <p:separator />  
                            <p:menuitem actionListener="#{jobManager.logout}"
                                        onstart="longProcessDialogVar.show();"                                               
                                        onerror="connectionErrorDialog.show();"                                              
                                        icon="ui-icon-circle-arrow-w"
                                        value="Logout"
                                        process="@this"/>                             
                        </p:menuButton>   

                    </h:panelGrid>

                    <p:remoteCommand name="updateHeaderForm"
                                     update="headerForm"
                                     process="@this"/>

                </h:form>
            </p:layoutUnit>

            <p:layoutUnit id="centreLayoutUnit"                           
                          position="center">

                <h:form id="mainTabViewForm">                    

                    <p:tabView id="mainTabView"                                                             
                               value="#{jobManager.mainTabView.tabs}" 
                               var="tab"                                
                               onTabShow="longProcessDialogVar.hide();"
                               widgetVar="mainTabViewVar">

                        <p:ajax event="tabChange"       
                                immediate="true"
                                process="@this"
                                listener="#{jobManager.onMainViewTabChange}" />

                        <p:ajax event="tabClose" 
                                immediate="true"
                                process="@this"
                                listener="#{jobManager.onMainViewTabClose}" />  

                        <p:tab title="#{tab.name}" closable="true"  >
                            <h:panelGroup rendered="#{tab.renderJobsTab}">                                
                                <ui:include src="jmts/jobsTab.xhtml" />   
                            </h:panelGroup>
                            <h:panelGroup  rendered="#{tab.renderFinancialAdminTab}">
                                <ui:include src="admin/financialAdminTab.xhtml" /> 
                            </h:panelGroup>
                            <h:panelGroup rendered="#{tab.renderAdminTab}" >
                                <ui:include src="admin/generalAdminTab.xhtml" /> 
                            </h:panelGroup>
                            <h:panelGroup rendered="#{tab.renderJobDetailTab}" >
                                <ui:include src="jmts/jobDetail.xhtml"/> 
                            </h:panelGroup>
                            <h:panelGroup rendered="#{tab.renderClientsTab}" >
                                <ui:include src="client/clientsTab.xhtml" />                                                                
                            </h:panelGroup>
                        </p:tab>
                    </p:tabView>

                    <p:commandButton
                        id="doNothingButton"
                        style="visibility: hidden;"
                        global="false"                                        
                        value=""                                       
                        title="This is the default button that accepts the enter key press"                                       
                        process="@this"/> 

                    <p:defaultCommand target=":mainTabViewForm:doNothingButton" />
                </h:form>
            </p:layoutUnit>

            <p:layoutUnit
                id="dashboard"    
                position="west" 
                size="350"                
                header="Dashboard"
                resizable="true"                  
                collapsed="#{jobManager.westLayoutUnitCollapsed}"
                collapsible="true">   
                <h:form id="dashboardForm" > 
                    <p:accordionPanel id="dashboardAccordion" 
                                      value="#{jobManager.dashboard.tabs}" 
                                      var="tab" 
                                      widgetVar="dashboardAccordionVar"
                                      
                                      multiple="true">

                        <p:ajax event="tabChange"       
                                immediate="true"
                                process="@this"
                                listener="#{jobManager.onDashboardTabChange}" />

                        <p:tab title="#{tab.name}" >
                            <h:panelGroup rendered="#{tab.renderJobsTab}">                                
                                <ui:include src="jmts/jobSearch.xhtml"/>
                                <h:panelGrid columns="3">
                                    <p:commandButton
                                        id="createNewJobButton"
                                        actionListener="#{jobManager.createNewJob}"
                                        global="true"                                        
                                        onstart="longProcessDialogVar.show();" 
                                        onerror="connectionErrorDialog.show();"
                                        value="New"                                       
                                        title="Create new job"
                                        icon="ui-icon-plusthick"
                                        process="@this">  

                                        <p:resetInput target=":mainTabViewForm:mainTabView" />

                                    </p:commandButton>

                                    <p:commandButton
                                        value="Reports"
                                        actionListener="#{jobManager.initJobReport}"
                                        onstart="longProcessDialogVar.show();"
                                        update=":reportingDialogForm"                                        
                                        oncomplete="reportingDialog.show();"
                                        onerror="connectionErrorDialog.show();"
                                        title="Generate, view and export reports"
                                        icon="ui-icon-newwin"
                                        process="@this"/>

                                </h:panelGrid>   
                            </h:panelGroup>
                            <h:panelGroup  rendered="#{tab.renderFinancialAdminTab}">
                                NB: For testing...remove before next deploy 
                            </h:panelGroup>
                            <h:panelGroup rendered="#{tab.renderAdminTab}" >
                                NB: For testing...remove before next deploy
                            </h:panelGroup>                                  
                        </p:tab>                       
                    </p:accordionPanel>                    
                </h:form>

            </p:layoutUnit>

        </p:layout>

    </h:body>
</html>

