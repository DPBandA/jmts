<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml"
      xmlns:h="http://java.sun.com/jsf/html"
      xmlns:p="http://primefaces.org/ui"
      xmlns:f="http://java.sun.com/jsf/core"
      xmlns:ui="http://java.sun.com/jsf/facelets">
    <h:form id="jobDialogForm">
        <p:growl id="growl" life="2000" />
        <p:remoteCommand name="doJobSampleCopy"
                         action="#{jobManager.copyJobSample}"
                         oncomplete="jobSampleDialog.show();"
                         update=":jobSampleDialogForm"
                         process="@this"/>
        <p:dialog width="800"
                  height="600"
                  draggable="true" 
                  modal="true"
                  widgetVar="jobDialog"
                  maximizable="false"
                  closable="true"
                  header="Job Detail" >

            <p:ajax event="close"                                      
                    async="true"  
                    onstart="longProcessDialogVar.show();"
                    oncomplete="longProcessDialogVar.hide();jobFormTabVar.select(0);"
                    update="jobDialogForm"
                    listener="#{jobManager.closeJobDialog2}"/>

            <p:commandButton id="jobSaveButton1"
                             actionListener="#{jobManager.saveCurrentJob}"                            
                             onstart="longProcessDialogVar.show();"
                             oncomplete="longProcessDialogVar.hide();"
                             value="Save"
                             update="jobDialogForm:jobFormTabView:jobStatusAndTracking,jobDialogForm:jobFormTabView:subContractedDepartment,:jobDialogForm:jobFormTabView:jobNumber,:jobDialogForm:jobFormTabView:jobNumber2,:mainTabViewForm:mainTabView:jobsDatabaseTable,:jobDialogForm:jobFormTabView:jobSamples,formsMenuButton"
                             title="Save current job"
                             icon="ui-icon-disk"
                             process="@this,jobDialogForm:jobFormTabView:subContractedDepartment"/>
            <p:spacer height="0" width="10"/>
            <p:commandButton value="Close"
                             actionListener="#{jobManager.closeJobDialog1}"
                             onstart="longProcessDialogVar.show();"
                             oncomplete="longProcessDialogVar.hide();jobFormTabVar.select(0);"
                             async="true"                            
                             update="jobDialogForm"
                             process="@this"
                             icon="ui-icon ui-icon-close" />
            <p:spacer height="0" width="100"/>

            <p:commandButton
                value="Subcontract..."

                actionListener="#{jobManager.subContractJob}"
                update="jobSaveButton1,jobSaveButton2,formsMenuButton,jobDialogForm:jobFormTabView,jobDialogForm:jobFormTabView:jobSamples"
                global="true"               
                onstart="longProcessDialogVar.show();"
                oncomplete="handleCreateJobCopy(xhr, status, args);longProcessDialogVar.hide();"
                title="Subcontract the current job by first creating a copy."
                icon="ui-icon-copy"
                process="@this"/>

            <p:spacer height="0" width="200"/>

            <p:menuButton id="formsMenuButton" value="Forms" rendered="true" >
                <p:menuitem value="Service Contract"
                            ajax="false"
                            disabled="#{!jobManager.currentJobIsValid}"
                            actionListener="#{jobManager.updateServiceContract}"
                            update="longProgressDialogForm2"
                            onclick="longProcessDialogVar2.show();" >
                    <p:fileDownload value="#{jobManager.serviceContractFile}" />
                </p:menuitem>
            </p:menuButton>

            <hr/>
            <p:tabView id="jobFormTabView"
                       widgetVar="jobFormTabVar" >

                <p:ajax event="tabChange" 
                        onstart="longProcessDialogVar.show();"
                        oncomplete="longProcessDialogVar.hide();" />

                <p:tab title="General" >
                    <ui:insert>
                        <ui:include src="jobGeneralTab.xhtml"/>
                    </ui:insert>
                </p:tab>                

                <p:tab title="Service">
                    <ui:insert>
                        <ui:include src="serviceTab.xhtml"/>
                    </ui:insert>
                </p:tab>

                <p:tab title="Samples">
                    <ui:insert>                        
                        <ui:include src="samplesTab.xhtml"/>
                    </ui:insert>
                </p:tab>

                <p:tab title="Costing &amp; Payment">
                    <ui:insert>                        
                        <ui:include src="jobCostingAndPaymentTab.xhtml"/>
                    </ui:insert>
                </p:tab>    

                <p:tab title="Grouping">
                    <ui:insert>
                        <ui:include src="jobGroupingTab.xhtml"/>
                    </ui:insert>
                </p:tab>

                <p:tab title="Status &amp; Tracking">
                    <ui:insert>
                        <ui:include src="jobStatusAndTrackingTab.xhtml"/>
                    </ui:insert>
                </p:tab>               

                <p:tab title="Reporting">
                    <ui:insert>
                        <ui:include src="reportingTab.xhtml"/>
                    </ui:insert>
                </p:tab>

            </p:tabView>

            <hr/>
            <p:commandButton id="jobSaveButton2"
                             actionListener="#{jobManager.saveCurrentJob}"                            
                             onstart="longProcessDialogVar.show();"
                             oncomplete="longProcessDialogVar.hide();"
                             value="Save"
                             update="jobDialogForm:jobFormTabView:jobStatusAndTracking,jobDialogForm:jobFormTabView:subContractedDepartment,:jobDialogForm:jobFormTabView:jobNumber,:jobDialogForm:jobFormTabView:jobNumber2,:mainTabViewForm:mainTabView:jobsDatabaseTable,:jobDialogForm:jobFormTabView:jobSamples,formsMenuButton"
                             title="Save current job"
                             icon="ui-icon-disk"
                             process="@this,jobDialogForm:jobFormTabView:subContractedDepartment"/>  
            <p:spacer height="0" width="10"/>
            <p:commandButton value="Close"
                             actionListener="#{jobManager.closeJobDialog1}"
                             onstart="longProcessDialogVar.show();"
                             oncomplete="longProcessDialogVar.hide();jobFormTabVar.select(0);"
                             async="true"                             
                             update="jobDialogForm"
                             process="@this"
                             icon="ui-icon ui-icon-close" />
            <p/>
        </p:dialog>

    </h:form>
</html>
