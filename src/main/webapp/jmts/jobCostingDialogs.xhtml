<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml"
      xmlns:h="http://java.sun.com/jsf/html"
      xmlns:f="http://java.sun.com/jsf/core"
      xmlns:p="http://primefaces.org/ui"
      xmlns:ui="http://java.sun.com/jsf/facelets">
    <h:form id="costingComponentDialogForm">
        <p:dialog width="400"
                  height="300"
                  draggable="true"
                  modal="true"
                  widgetVar="costingComponentDialog"
                  header="Costing Component" >       
            <p:commandButton value="Ok"
                             actionListener="#{jobManager.updateCostingComponent}"
                             update=":jobCostingDialogForm:costComponentsPanel,:jobCostingDialogForm:costingSummaryPanel,:jobDialogForm:jobSaveButton1,:jobDialogForm:jobSaveButton2"
                             onstart="longProcessDialogVar.show();"                              
                             oncomplete="costingComponentDialog.hide();longProcessDialogVar.hide();"
                             icon="ui-icon ui-icon-check"
                             process="@form"/>
            <p:commandButton value="Cancel"       
                             update=":jobCostingDialogForm:costComponentsPanel,:jobCostingDialogForm:costingSummaryPanel,:jobDialogForm:jobSaveButton1,:jobDialogForm:jobSaveButton2"
                             onstart="longProcessDialogVar.show();"                              
                             oncomplete="costingComponentDialog.hide();longProcessDialogVar.hide();"
                             icon="ui-icon-close"/>
            <hr/>
            <h:panelGrid id="costingComponentPanelGrid" columns="3" style="width: 100%">
                <h:panelGroup>
                    <p:tooltip for="isCostComponentHeading" value="Check if this is a header" showEffect="fade" hideEffect="fade" />
                    <h:outputLabel for="isCostComponentHeading" value="Is this a header?" style="font-weight: bold"/>
                </h:panelGroup>
                <p:spacer height="0" width="10"/>
                <p:selectBooleanCheckbox id="isCostComponentHeading"
                                         value="#{jobManager.selectedCostComponent.isHeading}" >
                    <p:ajax listener="#{jobManager.updateIsCostComponentHeading}"
                            update="costingComponentPanelGrid"
                            global="false"                            
                            process="@this"/>
                </p:selectBooleanCheckbox>


                <h:outputText value="Component:" style="font-weight: bold" />
                <p:spacer height="0" width="10"/>
                <p:inputText value="#{jobManager.selectedCostComponent.name}"
                             style="width: 85%;" >
                    <p:ajax event="change"
                            global="false"
                            listener="#{jobManager.updateJob}"
                            update=":jobDialogForm:jobSaveButton1,:jobDialogForm:jobSaveButton2"
                            process="@this"/>
                </p:inputText>

                <h:outputText rendered="#{!jobManager.selectedCostComponent.isHeading}" value="Cost Code:" style="font-weight: bold;" />
                <p:spacer rendered="#{!jobManager.selectedCostComponent.isHeading}" height="0" width="10"/>
                <p:selectOneMenu rendered="#{!jobManager.selectedCostComponent.isHeading}"
                                 id="costCode"
                                 value="#{jobManager.selectedCostComponent.code}"
                                 style="width: 85%" >
                    <p:ajax event="change"
                            global="false"
                            update=":jobDialogForm:jobSaveButton1,:jobDialogForm:jobSaveButton2"
                            listener="#{jobManager.updateCostCode}"
                            process="@this"/>
                    <f:selectItems  value="#{jobManager.allCostCodes}"
                                    var="costCode"
                                    itemValue="#{costCode.code}"
                                    itemLabel="#{costCode.code}"/>
                </p:selectOneMenu>

                <h:panelGroup rendered="#{!jobManager.selectedCostComponent.isHeading}">
                    <p:tooltip for="isCostComponentFixedCost" value="Check if this is a fixed cost" showEffect="fade" hideEffect="fade" />
                    <h:outputLabel for="isCostComponentFixedCost" value="Is this a fixed cost?" style="font-weight: bold"/>
                </h:panelGroup>
                <p:spacer height="0" width="10"/>
                <p:selectBooleanCheckbox id="isCostComponentFixedCost"
                                         rendered="#{!jobManager.selectedCostComponent.isHeading}"
                                         value="#{jobManager.selectedCostComponent.isFixedCost}" >
                    <p:ajax listener="#{jobManager.updateIsCostComponentFixedCost}"
                            update="costingComponentPanelGrid"
                            global="false"                            
                            process="@this"/>
                </p:selectBooleanCheckbox>

                <h:outputText rendered="#{!jobManager.selectedCostComponent.renderFixedCostingComponentFormFields}" 
                              value="Hours/Qty:" 
                              style="font-weight: bold;" />
                <p:spacer rendered="#{!jobManager.selectedCostComponent.renderFixedCostingComponentFormFields}" height="0" width="10"/>
                <p:inputText rendered="#{!jobManager.selectedCostComponent.renderFixedCostingComponentFormFields}" 
                             value="#{jobManager.selectedCostComponent.hoursOrQuantity}"
                             style="width: 85%">
                    <f:convertNumber minFractionDigits="2" maxFractionDigits="2"/>
                    <p:ajax event="change"
                            global="false"
                            listener="#{jobManager.updateJob}"
                            update="costingComponentDialogForm:costComponentCost,:jobDialogForm:jobSaveButton1,:jobDialogForm:jobSaveButton2"
                            process="@this"/>
                </p:inputText>

                <h:outputText rendered="#{!jobManager.selectedCostComponent.renderFixedCostingComponentFormFields}" 
                              value="Rate ($/hr/qty):" style="font-weight: bold;" />
                <p:spacer rendered="#{!jobManager.selectedCostComponent.renderFixedCostingComponentFormFields}" height="0" width="10"/>
                <p:inputText rendered="#{!jobManager.selectedCostComponent.renderFixedCostingComponentFormFields}" 
                             value="#{jobManager.selectedCostComponent.rate}"
                             style="width: 85%">
                    <f:convertNumber minFractionDigits="2" maxFractionDigits="2"/>
                    <p:ajax event="change"
                            global="false"
                            listener="#{jobManager.updateJob}"
                            update="costingComponentDialogForm:costComponentCost,:jobDialogForm:jobSaveButton1,:jobDialogForm:jobSaveButton2"
                            process="@this"/>
                </p:inputText>

                <h:outputText rendered="#{!jobManager.selectedCostComponent.isHeading}" value="Cost ($):" style="font-weight: bold;" />
                <p:spacer rendered="#{!jobManager.selectedCostComponent.isHeading}" height="0" width="10"/>
                <p:inputText id="costComponentCost"
                             rendered="#{!jobManager.selectedCostComponent.isHeading}"                            
                             value="#{jobManager.selectedCostComponent.cost}"
                             readonly="#{!jobManager.selectedCostComponent.isFixedCost}"
                             styleClass="#{!jobManager.selectedCostComponent.isFixedCost ? 'editableclass' : null}">
                    <f:convertNumber minFractionDigits="2" maxFractionDigits="2"/>
                    <p:ajax event="change"
                            global="false"
                            update=":jobDialogForm:jobSaveButton1,:jobDialogForm:jobSaveButton2"
                            listener="#{jobManager.updateJob}"
                            process="@this"/>
                </p:inputText>
                <h:outputText value=" "
                              rendered="#{jobManager.selectedCostComponent.isHeading}" />
            </h:panelGrid>
            <hr/>
            <p:commandButton value="Ok"
                             actionListener="#{jobManager.updateCostingComponent}"
                             update=":jobCostingDialogForm:costComponentsPanel,:jobCostingDialogForm:costingSummaryPanel,:jobDialogForm:jobSaveButton1,:jobDialogForm:jobSaveButton2"
                             onstart="longProcessDialogVar.show();"                              
                             oncomplete="costingComponentDialog.hide();longProcessDialogVar.hide();"
                             icon="ui-icon ui-icon-check"
                             process="@form"/>
            <p:commandButton value="Cancel"  
                             update=":jobCostingDialogForm:costComponentsPanel,:jobCostingDialogForm:costingSummaryPanel,:jobDialogForm:jobSaveButton1,:jobDialogForm:jobSaveButton2"
                             onstart="longProcessDialogVar.show();"                              
                             oncomplete="costingComponentDialog.hide();longProcessDialogVar.hide();"
                             icon="ui-icon-close"/>            
        </p:dialog>
    </h:form>
    <h:form id="jobCostingDialogForm">     
        <p:dialog width="800"
                  height="500"
                  draggable="true"
                  modal="true"
                  closable="false" 
                  widgetVar="jobCostingDialog"
                  header="Job Costing" >             
            <ui:insert>
                <ui:include src="jobCostingDialogControlPanel.xhtml"/>
            </ui:insert>

            <p:panel header="General Information">
                <h:panelGrid columns="3">
                    <h:outputText value="Department:" style="font-weight: bold; width: 30%" />
                    <p:spacer height="0" width="10"/>
                    <h:outputText value="#{jobManager.currentJob.departmentAssignedToJob.name}" style="width: 60%" />

                    <h:outputText value="Job number:" style="font-weight: bold;" />
                    <p:spacer height="0" width="10"/>
                    <h:outputText value="#{jobManager.currentJob.jobNumber}" />

                    <h:outputText value="Client" style="font-weight: bold;" />
                    <p:spacer height="0" width="10"/>
                    <h:outputText value="#{jobManager.currentJob.client.name}" />

                    <h:outputText value="Report number *:" style="font-weight: bold;" />
                    <p:spacer height="0" width="10"/>
                    <p:inputText value="#{jobManager.currentJob.reportNumber}" 
                                 required="false"
                                 style="width: 300px" >
                        <p:ajax event="keyup"
                                global="false"
                                update=":jobDialogForm:jobSaveButton1,:jobDialogForm:jobSaveButton2"
                                listener="#{jobManager.updateJobCostingValidity}"
                                process="@this"/>
                    </p:inputText>

                    <h:outputText value="Costing date:" style="font-weight: bold" />
                    <p:spacer height="0" width="10"/>
                    <p:calendar required="false"   
                                readonly="true"
                                readonlyInput="true"
                                showOn="none"                                                                    
                                id="costingDate"
                                value="#{jobManager.jobCostingDate}"
                                navigator="true"
                                pattern="MMM dd, yyyy" >
                        <p:ajax event="dateSelect" 
                                update=":jobDialogForm:jobSaveButton1,:jobDialogForm:jobSaveButton2"
                                listener="#{jobManager.handleJobCostingDateSelect}"/>
                        <p:ajax event="keyup" 
                                update=":jobDialogForm:jobSaveButton1,:jobDialogForm:jobSaveButton2"
                                listener="#{jobManager.handleJobCostingDateSelect}"/>
                    </p:calendar>

                    <h:outputText value="Purchase order #:" style="font-weight: bold;" />
                    <p:spacer height="0" width="10"/>
                    <p:inputText value="#{jobManager.currentJob.jobCostingAndPayment.purchaseOrderNumber}" 
                                 disabled="#{!jobManager.isAuthorizedToModifyCostings}"
                                 style="width: 300px">
                        <p:ajax event="keyup"
                                global="false"
                                listener="#{jobManager.updateJob}"
                                update=":jobDialogForm:jobSaveButton1,:jobDialogForm:jobSaveButton2"
                                process="@this"/>
                    </p:inputText>

                    <h:outputText value="Job description *:"  style="font-weight: bold" />
                    <p:spacer height="0" width="10"/>
                    <h:inputTextarea value="#{jobManager.currentJob.jobDescription}" 
                                     required="false"
                                     rows="2" style="width: 300px">
                        <p:ajax event="keyup"
                                global="false"
                                process="@this"
                                update=":jobDialogForm:jobSaveButton1,:jobDialogForm:jobSaveButton2"
                                listener="#{jobManager.updateJobCostingValidity}"/>
                    </h:inputTextarea>

                    <h:outputText value="* = required" />
                    <h:outputText value=""/>
                    <h:outputText value=""/>

                </h:panelGrid>
            </p:panel>
            <!-- Job costings and components -->
            <p:panel id="costComponentsPanel" header="Costings" >
                <h:panelGroup>                   
                    <h:outputLabel value="Choose costing template: "
                                   title="Choose an existing costing template"/>
                    <p:autoComplete maxResults="12"
                                    dropdown="true"
                                    value="#{jobManager.selectedJobCostingTemplate}"
                                    title="Choose an existing costing template name"
                                    style="width: 150px"
                                    forceSelection="true"
                                    completeMethod="#{jobManager.completeJobCostingAndPaymentName}">
                        <p:ajax event="itemSelect"
                                update=":jobCostingDialogForm:costComponentsPanel,:jobCostingDialogForm:costingSummaryPanel"
                                listener="#{jobManager.updateCostingComponents}"
                                process="@this"/>                      
                    </p:autoComplete>
                </h:panelGroup>

                <h:panelGroup>
                    <p:spacer height="0" width="20"/>
                    <h:outputLabel value="Template name: "/>
                    <p:inputText id="jobCostingsTemplateName"
                                 value="#{jobManager.currentJob.jobCostingAndPayment.name}"
                                 disabled="true"
                                 style="width: 150px;background-color: lightgoldenrodyellow;font-weight: bolder">
                        <p:ajax event="keyup"
                                global="false"
                                listener="#{jobManager.updateJob}"
                                process="@this"/>
                    </p:inputText>
                </h:panelGroup>

                <hr/>
                <p:commandButton title="Add new cost component"
                                 value="New Item"
                                 actionListener="#{jobManager.createNewCostComponent}"
                                 disabled="#{jobManager.completed}"
                                 update=":costingComponentDialogForm"
                                 onstart="longProcessDialogVar.show();"
                                 oncomplete="costingComponentDialog.show();longProcessDialogVar.hide();"
                                 icon="ui-icon-plus"
                                 process="@this">
                </p:commandButton>
                <hr/>
                <p:dataTable  var="costComponent"
                              id="i#{jobCosting.id}"
                              rowStyleClass="#{costComponent.isHeading ? 'header' : null}"
                              value="#{jobManager.currentJob.jobCostingAndPayment.allSortedCostComponents}">
                    <p:column>
                        <f:facet name="header">
                            <h:outputText value="Component" />
                        </f:facet>
                        <h:outputText value="#{costComponent.name}" />                    
                    </p:column>
                    <p:column rendered="#{!costComponent.isHeading}">
                        <f:facet name="header">
                            <h:outputText value="Code" />
                        </f:facet>
                        <h:outputText value="#{costComponent.code}" />
                    </p:column>

                    <p:column rendered="#{costComponent.isHeading}">
                        <f:facet name="header">
                            <h:outputText value=" " />
                        </f:facet>
                        <h:outputText value=" " />
                    </p:column>

                    <p:column rendered="#{!costComponent.isHeading}" >
                        <f:facet name="header">
                            <h:outputText value="Hours/Qty"/>
                        </f:facet>
                        <h:outputText value="#{costComponent.hoursOrQuantity}">
                            <f:convertNumber minFractionDigits="2" maxFractionDigits="2"/>
                        </h:outputText>
                    </p:column>

                    <p:column rendered="#{costComponent.isHeading}">
                        <f:facet name="header">
                            <h:outputText value=" " />
                        </f:facet>
                        <h:outputText value=" " />
                    </p:column>

                    <p:column  rendered="#{!costComponent.isHeading}">
                        <f:facet name="header">
                            <h:outputText value="Rate ($/hr/qty)" />
                        </f:facet>
                        <h:outputText value="#{costComponent.rate}">
                            <f:convertNumber minFractionDigits="2" maxFractionDigits="2"/>
                        </h:outputText>
                        <f:facet name="footer">
                            <h:outputText value="Total ($):" style="text-align: right" />
                        </f:facet>
                    </p:column>

                    <p:column rendered="#{costComponent.isHeading}">
                        <f:facet name="header">
                            <h:outputText value=" " />
                        </f:facet>
                        <h:outputText value=" " />
                    </p:column>

                    <p:column rendered="#{!costComponent.isHeading}">
                        <f:facet name="header">
                            <h:outputText value="Cost($)" />
                        </f:facet>
                        <h:outputText value="#{costComponent.cost}">
                            <f:convertNumber minFractionDigits="2" maxFractionDigits="2"/>
                        </h:outputText>
                        <f:facet name="footer">
                            <h:outputText value="#{jobManager.currentJob.jobCostingAndPayment.finalCost}" 
                                          style="text-align: right" >
                                <f:convertNumber minFractionDigits="2" maxFractionDigits="2"/>
                            </h:outputText>
                        </f:facet>
                    </p:column>

                    <p:column rendered="#{costComponent.isHeading}">
                        <f:facet name="header">
                            <h:outputText value=" " />
                        </f:facet>
                        <h:outputText value=" " />
                    </p:column>

                    <p:column style="width:32px" >
                        <f:facet name="header">
                            <h:outputText value="Edit" />
                        </f:facet>
                        <p:commandButton title="Edit cost component details"
                                         actionListener="#{jobManager.editCostComponent}"
                                         disabled="#{!costComponent.isEditable or jobManager.completed}"
                                         update=":costingComponentDialogForm"
                                         oncomplete="costingComponentDialog.show();"
                                         icon="ui-icon ui-icon-pencil"
                                         process="@this">
                            <f:setPropertyActionListener value="#{costComponent}"
                                                         target="#{jobManager.selectedCostComponent}" />
                        </p:commandButton>
                    </p:column>
                    <p:column style="width:32px" >
                        <f:facet name="header">
                            <h:outputText value="Delete" />
                        </f:facet>
                        <p:commandButton title="Delete cost component"        
                                         disabled="#{jobManager.completed}"
                                         onclick="costComponentDeleteConfirm.show();"
                                         icon="ui-icon-trash"
                                         process="@this">
                            <f:setPropertyActionListener value="#{costComponent}"
                                                         target="#{jobManager.selectedCostComponent}" />
                        </p:commandButton>
                    </p:column>
                </p:dataTable>
                <hr/>
                <p:commandButton title="Add new cost component"
                                 value="New Item"
                                 disabled="#{jobManager.completed}"
                                 actionListener="#{jobManager.createNewCostComponent}"
                                 update=":costingComponentDialogForm"
                                 onstart="longProcessDialogVar.show();"
                                 oncomplete="costingComponentDialog.show();longProcessDialogVar.hide();"
                                 icon="ui-icon-plus"
                                 process="@this">
                </p:commandButton>
            </p:panel>
            <p:panel id="costingSummaryPanel" header="Summary">
                <h:panelGrid columns="3">
                    <h:outputText value="Invoice number:" style="font-weight: bold;"/>
                    <p:spacer height="0" width="10"/>
                    <p:inputText value="#{jobManager.currentJob.jobCostingAndPayment.invoiceNumber}"
                                 disabled="#{!jobManager.isAuthorizedToModifyCostings}"
                                 maxlength="250" >
                        <p:ajax event="keyup"
                                global="false"
                                update=":jobDialogForm:jobSaveButton1,:jobDialogForm:jobSaveButton2"
                                listener="#{jobManager.updateJob}"
                                process="@this"/>
                    </p:inputText>

                    <h:outputText value="Receipt #s:" style="font-weight: bold;" />
                    <p:spacer height="0" width="10"/>
                    <p:inputText value="#{jobManager.currentJob.jobCostingAndPayment.receiptNumber}" 
                                 disabled="#{!jobManager.isAuthorizedToModifyCostings}"
                                 style="width: 200px" >
                        <p:ajax event="keyup"
                                global="false"
                                listener="#{jobManager.updateJob}"
                                update=":jobDialogForm:jobSaveButton1,:jobDialogForm:jobSaveButton2"
                                process="@this"/>
                    </p:inputText>

                    <h:outputText value="Total paid ($):" style="font-weight: bold;" />
                    <p:spacer height="0" width="10"/>
                    <p:inputText value="#{jobManager.currentJob.jobCostingAndPayment.deposit}" 
                                 title="This can only be edited on the 'Costing' tab"
                                 readonly="true" 
                                 style="background-color: lightgoldenrodyellow !important;">
                        <f:convertNumber minFractionDigits="2" maxFractionDigits="2"/>
                        <p:ajax event="keyup"
                                global="false"
                                update=":jobCostingDialogForm:amountDue"
                                listener="#{jobManager.updateAmountDue}"
                                process="@this"/>
                    </p:inputText>

                    <ui:remove>                    
                        <h:outputText value="Discount ($):" style="font-weight: bold;" />
                        <p:spacer height="0" width="10"/>
                        <p:inputText value="#{jobManager.currentJob.jobCostingAndPayment.discount}" >
                            <f:convertNumber minFractionDigits="2" maxFractionDigits="2"/>
                            <p:ajax event="keyup"
                                    global="false"
                                    update=":jobCostingDialogForm:amountDue"
                                    listener="#{jobManager.updateAmountDue}"
                                    process="@this"/>
                        </p:inputText>
                    </ui:remove>

                    <h:outputText value="Job cost ($):" style="font-weight: bold;" />
                    <p:spacer height="0" width="10"/>
                    <p:inputText value="#{jobManager.currentJob.jobCostingAndPayment.finalCost}" 
                                 style="background-color: lightgoldenrodyellow !important;"
                                 readonly="true">
                        <f:convertNumber minFractionDigits="2" maxFractionDigits="2"/>                       
                    </p:inputText>

                    <h:outputText value="#{jobManager.currentJob.jobCostingAndPayment.totalTaxLabel}" style="font-weight: bold;" />
                    <p:spacer height="0" width="10"/>
                    <p:inputText value="#{jobManager.currentJob.jobCostingAndPayment.totalTax}" 
                                 style="background-color: lightgoldenrodyellow !important;"
                                 readonly="true">
                        <f:convertNumber minFractionDigits="2" maxFractionDigits="2"/>                       
                    </p:inputText>

                    <h:outputText value="#{jobManager.currentJob.jobCostingAndPayment.totalCostWithTaxLabel}"
                                  style="font-weight: bold;" />
                    <p:spacer height="0" width="10"/>
                    <p:inputText value="#{jobManager.currentJob.jobCostingAndPayment.totalCost}" 
                                 style="background-color: lightgoldenrodyellow !important;"
                                 readonly="true">
                        <f:convertNumber minFractionDigits="2" maxFractionDigits="2"/>                       
                    </p:inputText>

                    <h:outputText value="Amount due ($):" style="font-weight: bold;" />
                    <p:spacer height="0" width="10"/>
                    <p:inputText id="amountDue"
                                 value="#{jobManager.currentJob.jobCostingAndPayment.amountDue}"
                                 style="background-color: lightgoldenrodyellow !important;background-image: none;color: blue;"
                                 readonly="true">
                        <f:convertNumber minFractionDigits="2" maxFractionDigits="2"/>
                    </p:inputText>

                    <h:outputText value="Comments:"  style="font-weight: bold" />
                    <p:spacer height="0" width="10"/>
                    <h:inputTextarea value="#{jobManager.currentJob.comment}" rows="2" style="width: 450px">
                        <p:ajax event="keyup"
                                global="false"
                                listener="#{jobManager.updateJob}"
                                update=":jobDialogForm:jobSaveButton1,:jobDialogForm:jobSaveButton2"
                                process="@this"/>
                    </h:inputTextarea>
                </h:panelGrid>
            </p:panel>           
            <p:remoteCommand name="updateJobCostingDialogForm"
                             update="jobCostingDialogForm"
                             process="@this"/>  
        </p:dialog>
    </h:form>

    <h:form id="costComponentDeleteConfirmDialogForm">
        <p:confirmDialog severity="alert"
                         message="Are you sure you wish to delete this cost component?"
                         header="Delete Cost Component"
                         widgetVar="costComponentDeleteConfirm"
                         width="400">
            <p:commandButton value="Yes"      
                             actionListener="#{jobManager.deleteCostComponent}"
                             update=":jobCostingDialogForm:costComponentsPanel,:jobCostingDialogForm:costingSummaryPanel,:jobDialogForm:jobSaveButton1,:jobDialogForm:jobSaveButton2"
                             onstart="longProcessDialogVar.show();"
                             oncomplete="costComponentDeleteConfirm.hide();longProcessDialogVar.hide();"
                             icon="ui-icon ui-icon-check"
                             process="@this"/>
            <p:commandButton value="No"
                             onclick="costComponentDeleteConfirm.hide();"
                             icon="ui-icon-close"/>       
        </p:confirmDialog>
    </h:form>

    <h:form id="jobCostingSaveConfirmDialogForm">
        <p:confirmDialog severity="alert"
                         message="The current job costing was modified. Do you wish to save it?"
                         header="Job Costing Modified (#{jobManager.currentJob.jobNumber})"
                         widgetVar="jobCostingSaveConfirm"
                         width="425">

            <p:commandButton value="Yes"                             
                             actionListener="#{jobManager.validateJobCostingAndSaveJob}"
                             onstart="longProcessDialogVar.show();"                             
                             oncomplete="longProcessDialogVar.hide();jobCostingSaveConfirm.hide();"
                             icon="ui-icon-check"
                             process="@this"/>
            <p:commandButton value="No"   
                             actionListener="#{jobManager.cancelJobEdit}"
                             update=":jobCostingDialogForm,:jobDialogForm:jobFormTabView:jobCosting"
                             oncomplete="jobCostingSaveConfirm.hide();jobCostingDialog.hide();"
                             icon="ui-icon-close"/>       
        </p:confirmDialog>
    </h:form>


    <h:form id="jobCostingTemplateNameDialogForm">
        <p:dialog width="400"
                  height="100"
                  draggable="true"
                  modal="true"
                  widgetVar="jobCostingTemplateNameDialog"
                  header="Costing Template Name" >       

            <h:panelGrid columns="2" >
                <h:outputLabel value="Template name: " style="font-weight: bold"/>
                <p:inputText value="#{jobManager.currentJob.jobCostingAndPayment.name}"
                             style="width: 200px">
                    <p:ajax event="keyup"
                            global="false"
                            listener="#{jobManager.updateJob}"
                            process="@this"/>
                </p:inputText>
            </h:panelGrid>
            <hr/>
            <p:commandButton value="Ok"               
                             actionListener="#{jobManager.validateJobCostingAndSaveJob}"
                             update=":jobCostingDialogForm:jobCostingsTemplateName"                                    
                             oncomplete="jobCostingTemplateNameDialog.hide();"
                             icon="ui-icon ui-icon-check"
                             process="@form"/>
            <p:commandButton value="Cancel"                                                      
                             oncomplete="jobCostingTemplateNameDialog.hide();"
                             icon="ui-icon-close"/>    

        </p:dialog>
    </h:form>
</html>
