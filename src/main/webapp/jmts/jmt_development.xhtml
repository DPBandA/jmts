<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html
    xmlns="http://www.w3.org/1999/xhtml"
    xmlns:h="http://java.sun.com/jsf/html"
    xmlns:f="http://java.sun.com/jsf/core"
    xmlns:p="http://primefaces.org/ui"
    xmlns:ui="http://java.sun.com/jsf/facelets">
    <h:head>
        <meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />        
        <meta http-equiv="cache-control" content="max-age=0" />
        <meta http-equiv="cache-control" content="no-cache" />
        <meta http-equiv="expires" content="0" />
        <meta http-equiv="expires" content="Tue, 01 Jan 1980 1:00:00 GMT" />
        <meta http-equiv="pragma" content="no-cache" />
        <title>BSJ Job Management &amp; Tracking System</title>
        <style type="text/css">
            .ui-layout-north {
                z-index:20 !important;
                overflow:visible !important;;
            }

            .ui-layout-north .ui-layout-unit-content {
                overflow:visible !important;
            }


            .ui-widget {
                font-size: 80%;
            }
            .jobNumberClass {
                width: 100%;
                color: orange;
            }      
            .hold {
                color: red;
                font-size: 1.2em;
                background-image: none;
                font-weight: bolder;
            }
            .active {
                color: green;
                font-size: 1.2em;
                background-image: none;
                font-weight: bolder;
            }   
            .due {
                background-color: yellow;
                background-image: none;
                color: #000000;
            }
            .overdue {
                background-color: yellow;
                background-image: none;
                color: #000000;
            }
            .lightgreybg {
                background-color:lightgrey;
                background-image: none;
                color: #000000;
            }
            .lightsteelbg {
                background-color:lightsteelblue;
                background-image: none;
                color: #000000;
            }
            .header {
                background-color: gray;
                background-image: none;
                color: white;
            }
            .rdonly {
                background-color: lightgrey;
                background-image: none;
                color: blue;
            }
        </style>
        <script type="text/javascript" src="jmtsJavascript.js" />
        <script type="text/javascript" src="cdbJavascript.js" />
        <script type="text/javascript" src="commonJavascript.js" />        

    </h:head>
    <h:body onload="checkWhichBrowser();
            longProcessDialogVar.hide();">

        <ui:insert>       
            <ui:include src="commonDialogs.xhtml" />
            <ui:include src="clientForm.xhtml" />
            <ui:include src="loginDialog.xhtml"/>
            <ui:include src="accPacClientInformationDialog.xhtml"/>
            <ui:include src="reportingDialog.xhtml"/>
            <ui:include src="jobSampleDialogs.xhtml"/>
            <ui:include src="jobDialog.xhtml"/>
            <ui:include src="jmtsAlertDialogs.xhtml"/>
            <ui:include src="generalAlertDialogs.xhtml"/>
            <ui:include src="connectionErrorAlertDialog.xhtml"/>
            <ui:include src="longProcessDialog.xhtml"/>   
            <ui:include src="jobCostingDialogs.xhtml"/>    
            <ui:include src="saveConfirmationDialogs.xhtml"/>
            <ui:include src="preferencesDialog.xhtml"/>        
            <ui:include src="cdbProductInspectionDialogs.xhtml"/>           
            <ui:include src="cdbComplianceSurveyDialogs.xhtml"/>  
            <ui:include src="cdbAlertDialogs.xhtml"/>
        </ui:insert>

        <!-- Unit dialogs that are rendered on demand based on user preferences-->  
        <h:form id="unitDialogForms">            
            <ui:insert >
                <ui:include src="serviceRequestDialogs.xhtml"/>                
                <ui:include src="petrolStationsDatabaseDialogs.xhtml"/>  
                <ui:include src="scalesDatabaseDialogs.xhtml"/>        

            </ui:insert>
        </h:form>


        <p:layout id="JMTSWeb" fullPage="true" widgetVar="layoutVar" >
            <p:ajax event="toggle" listener="#{main.handleLayoutUnitToggle}" />

            <p:layoutUnit position="north" 
                          rendered="true" 
                          size="85"                          
                          header="Job Management &amp; Tracking System" >
                <h:form id="headerForm">   

                    <p:growl id="growl" for="growlKey" showDetail="true" sticky="true" />

                    <p:menubar>
                        <p:submenu label="Databases" icon="ui-icon-disk">
                            <p:menuitem value="Client" url="#" />
                            <p:menuitem value="Standards Compliance" url="#" />
                            <p:menuitem value="Food Factory" url="#" />
                            <p:menuitem value="Legal Metrology" url="#" />
                        </p:submenu>

                        <p:submenu label="Edit" icon="ui-icon-pencil">
                            <p:menuitem value="Undo" url="#" icon="ui-icon-arrowreturnthick-1-w"></p:menuitem>
                            <p:menuitem value="Redo" url="#" icon="ui-icon-arrowreturnthick-1-e"></p:menuitem>
                        </p:submenu>


                        <p:submenu style="margin-left: 100px" 
                                   label="#{main.user.employee.firstName} #{main.user.employee.lastName}" 
                                   icon="ui-icon-person">
                            <p:menuitem actionListener="#{main.editPreferences}"
                                        onstart="longProcessDialogVar.show();"
                                        update=":preferencesDialogForm"
                                        oncomplete="longProcessDialogVar.hide();preferencesDialog.show();"
                                        onerror="connectionErrorDialog.show();"    
                                        value="Preferences"
                                        process="@this"/>
                            <p:separator />  
                            <p:menuitem actionListener="#{main.logout}"
                                        onstart="longProcessDialogVar.show();"                                               
                                        onerror="connectionErrorDialog.show();"                                              
                                        icon="ui-icon-circle-arrow-w"
                                        value="Logout"
                                        process="@this"/>
                        </p:submenu>
                        
                    </p:menubar>

                    <ui:remove>
                        <table border="0" width="100%">
                            <tr>
                                <td>
                                    <img src="BSJ Logo.jpg" width="272" height="41" alt="BSJ Logo"/>
                                </td>

                                <td align="left">
                                    <h:outputText value="Job Management &amp; Tracking System"
                                                  style="color: gray; font-size: 14pt; font-weight: bold" />
                                </td>

                                <td align="right">
                                    <p:menuButton value="#{main.user.employee.firstName} #{main.user.employee.lastName}" 
                                                  rendered="#{main.renderUserMenu()}">
                                        <p:menuitem actionListener="#{main.editPreferences}"
                                                    onstart="longProcessDialogVar.show();"
                                                    update=":preferencesDialogForm"
                                                    oncomplete="longProcessDialogVar.hide();preferencesDialog.show();"
                                                    onerror="connectionErrorDialog.show();"    
                                                    value="Preferences"
                                                    process="@this"/>
                                        <p:separator />  
                                        <p:menuitem actionListener="#{main.logout}"
                                                    onstart="longProcessDialogVar.show();"                                               
                                                    onerror="connectionErrorDialog.show();"                                              
                                                    icon="ui-icon-circle-arrow-w"
                                                    value="Logout"
                                                    process="@this"/>
                                    </p:menuButton>                               
                                </td>                            

                            </tr>
                        </table>
                    </ui:remove>

                    <p:remoteCommand name="updateHeaderForm"
                                     update="headerForm"
                                     process="@this"/>

                </h:form>
            </p:layoutUnit>

            <p:layoutUnit id="centreLayoutUnit"                           
                          position="center">

                <h:form id="mainTabViewForm">

                    <p:tabView id="mainTabView"
                               dynamic="true"                              
                               widgetVar="mainTabViewVar">

                        <p:ajax event="tabChange" 
                                onstart="longProcessDialogVar.show();"
                                oncomplete="longProcessDialogVar.hide();"
                                listener="#{main.onMainTabChange}" />

                        <p:tab id="ServiceRequestTab" 
                               title="Service Requests"
                               closable="false"
                               rendered="#{main.user.serviceRequestUnit}">
                            <p:toolbar>
                                <p:toolbarGroup align="left" >
                                    <p:commandButton
                                        id="createNewServiceRequest"
                                        actionListener="#{serviceManager.createNewServiceRequest}"
                                        global="true"
                                        onstart="longProcessDialogVar.show();"
                                        onerror="connectionErrorDialog.show();"
                                        value="New"
                                        title="Create new service request"
                                        icon="ui-icon-plusthick"
                                        process="@this"/>
                                </p:toolbarGroup>
                            </p:toolbar>
                            <ui:insert>
                                <ui:include src="jmts/serviceRequestsTable.xhtml"/>  
                            </ui:insert>                            

                        </p:tab>

                        <p:tab id="jobsTab"
                               closable="false"
                               title="Jobs"
                               rendered="#{main.user.jobManagementAndTrackingUnit}" >
                            <p:toolbar>
                                <p:toolbarGroup align="left" >
                                    <p:commandButton
                                        id="createNewJobButton"
                                        actionListener="#{jobManager.createNewJob}"
                                        global="true"
                                        onstart="longProcessDialogVar.show();"
                                        oncomplete="longProcessDialogVar.hide();"
                                        onerror="connectionErrorDialog.show();"
                                        value="New"                                       
                                        title="Create new job"
                                        icon="ui-icon-plusthick"
                                        process="@this"/>

                                    <p:spacer height="0" width="200"/>
                                    <p:commandButton
                                        value="Reporting"
                                        actionListener="#{jobManager.initJobReport}"
                                        onstart="longProcessDialogVar.show();"
                                        update=":reportingDialogForm"
                                        oncomplete="reportingDialog.show();"
                                        onerror="connectionErrorDialog.show();"
                                        title="Generate, view and export reports"
                                        icon="ui-icon-newwin"
                                        process="@this"/>
                                </p:toolbarGroup>

                                <p:toolbarGroup align="right" >                                   
                                    <p:menuButton id="toolsButton" value="Tools" >
                                        <p:menuitem actionListener="#{jobManager.updateAccPacClient}"
                                                    onstart="longProcessDialogVar.show();"                                                    
                                                    value="Credit status"
                                                    update=":accPacClientInformationTabView:accPacClientCreditStatusForm"
                                                    oncomplete="accPacClientInformationDialog.show();longProcessDialogVar.hide();"
                                                    onerror="connectionErrorDialog.show();"
                                                    process="@this"/>

                                        <p:menuitem value="New Client"
                                                    onstart="longProcessDialogVar.show();"
                                                    actionListener="#{jobManager.createNewClient}"
                                                    update=":clientForm"
                                                    oncomplete="clientFormDialog.show();longProcessDialogVar.hide();"
                                                    process="@this"
                                                    title="Add a new client"/>
                                    </p:menuButton>                                    

                                </p:toolbarGroup>
                            </p:toolbar>                           
                            <ui:insert>
                                <ui:include src="jobsDatabaseTable.xhtml"/>
                            </ui:insert>                      
                        </p:tab>

                        <p:tab id="StandardsComplianceTab" title="Standards Compliance"
                               closable="false"
                               rendered="#{main.user.complianceUnit}">
                            <p:tabView id="standardsComplianceTabView" 
                                       activeIndex="#{complianceManager.standardsComplianceMetTabViewActiveIndex}"
                                       dynamic="true">
                                <p:ajax event="tabChange"    
                                        onstart="longProcessDialogVar.show();"
                                        oncomplete="longProcessDialogVar.hide();" />

                                <p:tab title="Compliance Survey" >
                                    <center><font color="green" size="4" face="TIMES NEW ROMAN">Compliance Surveys</font> </center>
                                    <hr align="CENTER/RIGHT" style="background-color: green" size="5" width="100%"/>

                                    <ui:insert>
                                        <ui:include src="cdbComplianceSurvey.xhtml"/>
                                    </ui:insert>

                                </p:tab>
                            </p:tabView>
                        </p:tab>

                        <p:tab id="LegalMetrologyTab" title="Legal Metrology"
                               closable="false" 
                               rendered="#{main.user.legalMetrologyUnit}">

                            <p:tabView id="legalMetTabView"
                                       dynamic="true"                                       
                                       activeIndex="#{legalMetrologyManager.legalMetTabViewActiveIndex}"
                                       widgetVar="legalMetTabViewVar">

                                <p:ajax event="tabChange" 
                                        onstart="longProcessDialogVar.show();"
                                        update=":searchForm"
                                        oncomplete="longProcessDialogVar.hide();" />

                                <p:tab id="petrolStationsTab" 
                                       title="Petrol Stations"
                                       closable="false">

                                    <p:toolbar>
                                        <p:toolbarGroup align="left" >
                                            <p:commandButton
                                                id="createNewPetrolStation"
                                                actionListener="#{legalMetrologyManager.createNewPetrolStation()}"
                                                value="New"
                                                onstart="longProcessDialogVar.show();"
                                                oncomplete="longProcessDialogVar.hide();"
                                                title="Create new petrol station"
                                                icon="ui-icon-plusthick"
                                                process="@this"/>                                            
                                        </p:toolbarGroup>

                                        <p:toolbarGroup align="right" >                                   
                                            <p:menuButton id="toolsButton" value="Tools" >
                                                <p:menuitem actionListener="#{jobManager.updateAccPacClient}"
                                                            onstart="longProcessDialogVar.show();"
                                                            value="Credit status"
                                                            update=":accPacClientInformationTabView:accPacClientCreditStatusForm"
                                                            oncomplete="accPacClientInformationDialog.show();longProcessDialogVar.hide();"
                                                            onerror="connectionErrorDialog.show();"
                                                            process="@this"/>
                                            </p:menuButton>
                                        </p:toolbarGroup>
                                    </p:toolbar>

                                    <ui:insert>                                      
                                        <ui:include src="petrolStationsDatabaseTable.xhtml"/>
                                    </ui:insert>   
                                </p:tab>

                                <p:tab id="scalesTab" title="Scales"
                                       closable="false">
                                    <p:toolbar>
                                        <p:toolbarGroup align="left" >
                                            <p:commandButton                                                
                                                actionListener="#{legalMetrologyManager.createNewScale()}"
                                                value="New"
                                                onstart="longProcessDialogVar.show();"
                                                oncomplete="longProcessDialogVar.hide();"
                                                title="Create new scale"
                                                icon="ui-icon-plusthick"
                                                process="@this"/>                                          
                                        </p:toolbarGroup>

                                        <p:toolbarGroup align="right" >                                   
                                            <p:menuButton value="Tools" >
                                                <p:menuitem actionListener="#{jobManager.updateAccPacClient}"
                                                            onstart="longProcessDialogVar.show();"
                                                            value="Credit status"
                                                            update=":accPacClientInformationTabView:accPacClientCreditStatusForm"
                                                            oncomplete="accPacClientInformationDialog.show();longProcessDialogVar.hide();"
                                                            onerror="connectionErrorDialog.show();"
                                                            process="@this"/>
                                            </p:menuButton>
                                        </p:toolbarGroup>
                                    </p:toolbar>

                                    <ui:insert>                                      
                                        <ui:include src="scalesDatabaseTable.xhtml"/>
                                    </ui:insert>   
                                </p:tab>

                                <ui:remove>
                                    <p:tab id="legalMetrologyClientsTab" title="Clients"
                                           closable="false">                                     
                                    </p:tab>

                                    <p:tab id="legalMetrologyReportsTab" title="Reports"
                                           closable="false">                                     
                                    </p:tab>
                                </ui:remove>
                            </p:tabView>
                        </p:tab>

                        <p:tab id="FoodsTab" title="Foods"
                               closable="false"
                               rendered="#{main.user.foodsUnit}">
                        </p:tab>

                        <p:tab id="StandardsAndCertificationTab" title="Standards &amp; Certification"
                               closable="false"
                               rendered="#{main.user.standardsAndCertificationUnit}">

                        </p:tab>
                    </p:tabView>
                </h:form>
            </p:layoutUnit>

            <p:layoutUnit
                id="searchLayoutUnit"    
                position="west" size="350"
                header="Advanced Search"
                resizable="true"

                collapsed="#{main.searchLayoutUnitCollapsed}"
                collapsible="true">              

                <h:panelGrid columns="1">
                    <ui:insert>
                        <ui:include src="searchForm.xhtml"/>
                    </ui:insert>
                </h:panelGrid>


            </p:layoutUnit>

        </p:layout>

    </h:body>
</html>

